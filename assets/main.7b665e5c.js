class L{constructor(e){this.properties=e!=null?e:[]}get(e){const t=this.properties.filter(o=>o.name===e).map(o=>o.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const o=this.get(e);if(o!==void 0){if(t!=="json"&&typeof o!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return o}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const o=this.get(e);if(o===void 0)throw new Error('Property "'+e+'" is missing');if(t!=="json"&&typeof o!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return o}getType(e){const t=this.properties.filter(o=>o.name===e).map(o=>o.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const I="https://unpkg.com/@workadventure/scripting-api-extra@1.4.5/dist";class re{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new L(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function _(r){const e=r?"#"+r.join():"";WA.nav.openCoWebSite(I+"/configuration.html"+e)}async function oe(r,e){const t=await WA.room.getTiledMap(),o=new Map;return F(t.layers,o,r,e),o}function F(r,e,t,o){for(const n of r)if(n.type==="objectgroup"){for(const a of n.objects)if(a.type==="variable"||a.class==="variable"){if(!!t&&n.name!==t||!!o&&!o.includes(a.name))continue;e.set(a.name,new re(a))}}else n.type==="group"&&F(n.layers,e,t,o)}let x;async function M(){return x===void 0&&(x=ne()),x}async function ne(){return ae(await WA.room.getTiledMap())}function ae(r){const e=new Map;return H(r.layers,"",e),e}function H(r,e,t){for(const o of r)o.type==="group"?H(o.layers,e+o.name+"/",t):(o.name=e+o.name,t.set(o.name,o))}async function se(){const r=await M(),e=[];for(const t of r.values())if(t.type==="objectgroup")for(const o of t.objects)(o.type==="area"||o.class==="area")&&e.push(o);return e}function ie(r){let e=1/0,t=1/0,o=0,n=0;const a=r.data;if(typeof a=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<r.height;s++)for(let i=0;i<r.width;i++)a[i+s*r.width]!==0&&(e=Math.min(e,i),n=Math.max(n,i),t=Math.min(t,s),o=Math.max(o,s));return{top:t,left:e,right:n+1,bottom:o+1}}function X(r){let e=1/0,t=1/0,o=0,n=0;for(const a of r){const s=ie(a);s.left<e&&(e=s.left),s.top<t&&(t=s.top),s.right>n&&(n=s.right),s.bottom>o&&(o=s.bottom)}return{top:t,left:e,right:n,bottom:o}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var ue=Object.prototype.toString,C=Array.isArray||function(e){return ue.call(e)==="[object Array]"};function U(r){return typeof r=="function"}function ce(r){return C(r)?"array":typeof r}function B(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function N(r,e){return r!=null&&typeof r=="object"&&e in r}function le(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var pe=RegExp.prototype.test;function fe(r,e){return pe.call(r,e)}var ge=/\S/;function he(r){return!fe(ge,r)}var ye={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function de(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return ye[t]})}var me=/\s*/,be=/\s+/,K=/\s*=/,Ae=/\s*\}/,We=/#|\^|\/|>|\{|&|=|!/;function ve(r,e){if(!r)return[];var t=!1,o=[],n=[],a=[],s=!1,i=!1,u="",l=0;function f(){if(s&&!i)for(;a.length;)delete n[a.pop()];else a=[];s=!1,i=!1}var m,A,O;function P(v){if(typeof v=="string"&&(v=v.split(be,2)),!C(v)||v.length!==2)throw new Error("Invalid tags: "+v);m=new RegExp(B(v[0])+"\\s*"),A=new RegExp("\\s*"+B(v[1])),O=new RegExp("\\s*"+B("}"+v[1]))}P(e||d.tags);for(var c=new k(r),W,h,b,S,j,w;!c.eos();){if(W=c.pos,b=c.scanUntil(m),b)for(var R=0,te=b.length;R<te;++R)S=b.charAt(R),he(S)?(a.push(n.length),u+=S):(i=!0,t=!0,u+=" "),n.push(["text",S,W,W+1]),W+=1,S===`
`&&(f(),u="",l=0,t=!1);if(!c.scan(m))break;if(s=!0,h=c.scan(We)||"name",c.scan(me),h==="="?(b=c.scanUntil(K),c.scan(K),c.scanUntil(A)):h==="{"?(b=c.scanUntil(O),c.scan(Ae),c.scanUntil(A),h="&"):b=c.scanUntil(A),!c.scan(A))throw new Error("Unclosed tag at "+c.pos);if(h==">"?j=[h,b,W,c.pos,u,l,t]:j=[h,b,W,c.pos],l++,n.push(j),h==="#"||h==="^")o.push(j);else if(h==="/"){if(w=o.pop(),!w)throw new Error('Unopened section "'+b+'" at '+W);if(w[1]!==b)throw new Error('Unclosed section "'+w[1]+'" at '+W)}else h==="name"||h==="{"||h==="&"?i=!0:h==="="&&P(b)}if(f(),w=o.pop(),w)throw new Error('Unclosed section "'+w[1]+'" at '+c.pos);return Te(we(n))}function we(r){for(var e=[],t,o,n=0,a=r.length;n<a;++n)t=r[n],t&&(t[0]==="text"&&o&&o[0]==="text"?(o[1]+=t[1],o[3]=t[3]):(e.push(t),o=t));return e}function Te(r){for(var e=[],t=e,o=[],n,a,s=0,i=r.length;s<i;++s)switch(n=r[s],n[0]){case"#":case"^":t.push(n),o.push(n),t=n[4]=[];break;case"/":a=o.pop(),a[5]=n[2],t=o.length>0?o[o.length-1][4]:e;break;default:t.push(n)}return e}function k(r){this.string=r,this.tail=r,this.pos=0}k.prototype.eos=function(){return this.tail===""};k.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var o=t[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};k.prototype.scanUntil=function(e){var t=this.tail.search(e),o;switch(t){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=o.length,o};function T(r,e){this.view=r,this.cache={".":this.view},this.parent=e}T.prototype.push=function(e){return new T(e,this)};T.prototype.lookup=function(e){var t=this.cache,o;if(t.hasOwnProperty(e))o=t[e];else{for(var n=this,a,s,i,u=!1;n;){if(e.indexOf(".")>0)for(a=n.view,s=e.split("."),i=0;a!=null&&i<s.length;)i===s.length-1&&(u=N(a,s[i])||le(a,s[i])),a=a[s[i++]];else a=n.view[e],u=N(n.view,e);if(u){o=a;break}n=n.parent}t[e]=o}return U(o)&&(o=o.call(this.view)),o};function g(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}g.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};g.prototype.parse=function(e,t){var o=this.templateCache,n=e+":"+(t||d.tags).join(":"),a=typeof o!="undefined",s=a?o.get(n):void 0;return s==null&&(s=ve(e,t),a&&o.set(n,s)),s};g.prototype.render=function(e,t,o,n){var a=this.getConfigTags(n),s=this.parse(e,a),i=t instanceof T?t:new T(t,void 0);return this.renderTokens(s,i,o,e,n)};g.prototype.renderTokens=function(e,t,o,n,a){for(var s="",i,u,l,f=0,m=e.length;f<m;++f)l=void 0,i=e[f],u=i[0],u==="#"?l=this.renderSection(i,t,o,n,a):u==="^"?l=this.renderInverted(i,t,o,n,a):u===">"?l=this.renderPartial(i,t,o,a):u==="&"?l=this.unescapedValue(i,t):u==="name"?l=this.escapedValue(i,t,a):u==="text"&&(l=this.rawValue(i)),l!==void 0&&(s+=l);return s};g.prototype.renderSection=function(e,t,o,n,a){var s=this,i="",u=t.lookup(e[1]);function l(A){return s.render(A,t,o,a)}if(!!u){if(C(u))for(var f=0,m=u.length;f<m;++f)i+=this.renderTokens(e[4],t.push(u[f]),o,n,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")i+=this.renderTokens(e[4],t.push(u),o,n,a);else if(U(u)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,n.slice(e[3],e[5]),l),u!=null&&(i+=u)}else i+=this.renderTokens(e[4],t,o,n,a);return i}};g.prototype.renderInverted=function(e,t,o,n,a){var s=t.lookup(e[1]);if(!s||C(s)&&s.length===0)return this.renderTokens(e[4],t,o,n,a)};g.prototype.indentPartial=function(e,t,o){for(var n=t.replace(/[^ \t]/g,""),a=e.split(`
`),s=0;s<a.length;s++)a[s].length&&(s>0||!o)&&(a[s]=n+a[s]);return a.join(`
`)};g.prototype.renderPartial=function(e,t,o,n){if(!!o){var a=this.getConfigTags(n),s=U(o)?o(e[1]):o[e[1]];if(s!=null){var i=e[6],u=e[5],l=e[4],f=s;u==0&&l&&(f=this.indentPartial(s,l,i));var m=this.parse(f,a);return this.renderTokens(m,t,o,f,n)}}};g.prototype.unescapedValue=function(e,t){var o=t.lookup(e[1]);if(o!=null)return o};g.prototype.escapedValue=function(e,t,o){var n=this.getConfigEscape(o)||d.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&n===d.escape?String(a):n(a)};g.prototype.rawValue=function(e){return e[1]};g.prototype.getConfigTags=function(e){return C(e)?e:e&&typeof e=="object"?e.tags:void 0};g.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!C(e))return e.escape};var d={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){E.templateCache=r},get templateCache(){return E.templateCache}},E=new g;d.clearCache=function(){return E.clearCache()};d.parse=function(e,t){return E.parse(e,t)};d.render=function(e,t,o,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+ce(e)+'" was given as the first argument for mustache#render(template, view, partials)');return E.render(e,t,o,n)};d.escape=de;d.Scanner=k;d.Context=T;d.Writer=g;class Z{constructor(e,t){this.template=e,this.state=t,this.ast=d.parse(e)}getValue(){return this.value===void 0&&(this.value=d.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const o of this.getUsedVariables().values())t.push(this.state.onVariableChange(o).subscribe(()=>{const n=d.render(this.template,this.state);n!==this.value&&(this.value=n,e(this.value))}));return{unsubscribe:()=>{for(const o of t)o.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const o of e){const n=o[0],a=o[1],s=o[4];["name","&","#","^"].includes(n)&&t.add(a),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,t)}}}async function Ce(){var r;const e=await se();for(const t of e){const o=(r=t.properties)!==null&&r!==void 0?r:[];for(const n of o){if(n.type==="int"||n.type==="bool"||n.type==="object"||typeof n.value!="string")continue;const a=new Z(n.value,WA.state);if(a.isPureString())continue;const s=a.getValue();await Q(t.name,n.name,s),a.onChange(async i=>{await Q(t.name,n.name,i)})}}}async function Pe(){var r;const e=await M();for(const[t,o]of e.entries())if(o.type!=="objectgroup"){const n=(r=o.properties)!==null&&r!==void 0?r:[];for(const a of n){if(a.type==="int"||a.type==="bool"||a.type==="object"||typeof a.value!="string")continue;const s=new Z(a.value,WA.state);if(s.isPureString())continue;const i=s.getValue();q(t,a.name,i),s.onChange(u=>{q(t,a.name,u)})}}}async function Q(r,e,t){console.log(r),(await WA.room.area.get(r)).setProperty(e,t)}function q(r,e,t){WA.room.setProperty(r,e,t),e==="visible"&&(t?WA.room.showLayer(r):WA.room.hideLayer(r))}let V,D=0,Y=0;function z(r){if(WA.state[r.name]){let e=r.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=r.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=r.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=r.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function Se(r){const e=r.properties.getString("openSound"),t=r.properties.getNumber("soundRadius");let o=1;if(t){const n=ee(r.properties.mustGetString("openLayer").split(`
`));if(n>t)return;o=1-n/t}e&&WA.sound.loadSound(e).play({volume:o})}function Le(r){const e=r.properties.getString("closeSound"),t=r.properties.getNumber("soundRadius");let o=1;if(t){const n=ee(r.properties.mustGetString("closeLayer").split(`
`));if(n>t)return;o=1-n/t}e&&WA.sound.loadSound(e).play({volume:o})}function J(r){return r.map(e=>V.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function ee(r){const e=J(r),t=X(e),o=((t.right-t.left)/2+t.left)*32,n=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(D-o,2)+Math.pow(Y-n,2))}function Ee(r){WA.state.onVariableChange(r.name).subscribe(()=>{WA.state[r.name]?Se(r):Le(r),z(r)}),z(r)}function Me(r,e,t,o){const n=r.name;let a,s,i=!1;const u=t.getString("tag");let l=!0;u&&!WA.player.tags.includes(u)&&(l=!1);const f=!!u;function m(){var c;a&&a.remove(),a=WA.ui.displayActionMessage({message:(c=t.getString("closeTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,A()}})}function A(){var c;a&&a.remove(),a=WA.ui.displayActionMessage({message:(c=t.getString("openTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,m()}})}function O(c){const W=X(J(e.properties.mustGetString("closeLayer").split(`
`)));s=WA.room.website.create({name:"doorKeypad"+c,url:o+"/keypad.html#"+encodeURIComponent(c),position:{x:W.right*32,y:W.top*32,width:32*3,height:32*4},allowApi:!0})}function P(){s&&(WA.room.website.delete(s.name),s=void 0)}WA.room.onEnterLayer(n).subscribe(()=>{if(i=!0,t.getBoolean("autoOpen")&&l){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(f&&!l||!f)&&(t.getString("code")||t.getString("codeVariable"))){O(n);return}!l||(WA.state[e.name]?m():A())}),WA.room.onLeaveLayer(n).subscribe(()=>{i=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),a&&a.remove(),P()}),WA.state.onVariableChange(e.name).subscribe(()=>{i&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&m(),s&&WA.state[e.name]===!0&&P(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&A())})}function ke(r){const e=r.properties.mustGetString("bellSound"),t=r.properties.getNumber("soundRadius");let o=1;if(t){const n=Math.sqrt(Math.pow(r.x-D,2)+Math.pow(r.y-Y,2));if(n>t)return;o=1-n/t}WA.sound.loadSound(e).play({volume:o})}function Oe(r){WA.state[r.name]===void 0&&(WA.state[r.name]=0),WA.state.onVariableChange(r.name).subscribe(()=>{WA.state[r.name]&&ke(r)})}function je(r,e,t){let o;const n=e.getString("bellPopup");WA.room.onEnterLayer(t).subscribe(()=>{var a;n?o=WA.ui.openPopup(n,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[r]=WA.state[r]+1}}]):WA.state[r]=WA.state[r]+1}),WA.room.onLeaveLayer(t).subscribe(()=>{o&&(o.close(),o=void 0)})}async function Re(r){r=r!=null?r:I;const e=await oe();V=await M();for(const t of e.values())t.properties.get("door")&&Ee(t),t.properties.get("bell")&&Oe(t);for(const t of V.values()){const o=new L(t.properties),n=o.getString("doorVariable");if(n&&t.type==="tilelayer"){const s=e.get(n);if(s===void 0)throw new Error('Cannot find variable "'+n+'" referred in the "doorVariable" property of layer "'+t.name+'"');Me(t,s,o,r)}const a=o.getString("bellVariable");a&&je(a,o,t.name)}WA.player.onPlayerMove(t=>{D=t.x,Y=t.y})}function xe(r,e){const t=r.getString("bindVariable");if(t){const o=r.get("enterValue"),n=r.get("leaveValue"),a=r.getString("triggerMessage"),s=r.getString("tag");Be(t,e,o,n,a,s)}}function Be(r,e,t,o,n,a){a&&!WA.player.tags.includes(a)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{n||(WA.state[r]=t)}),o!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[r]=o}))}async function Ge(){const r=await M();for(const e of r.values()){const t=new L(e.properties);xe(t,e.name)}}let $;async function Ve(r){const e=await WA.room.getTiledMap();r=r!=null?r:I,$=await M();const t=e.layers.find(o=>o.name==="configuration");if(t){const n=new L(t.properties).getString("tag");(!n||WA.player.tags.includes(n))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(r+"/configuration.html",!0)});for(const a of $.values()){const s=new L(a.properties),i=s.getString("openConfig");i&&a.type==="tilelayer"&&Ie(i.split(","),a.name,s)}}}function Ie(r,e,t){let o;const n=t.getString("openConfigAdminTag");let a=!0;n&&!WA.player.tags.includes(n)&&(a=!1);function s(){var u;o&&o.remove(),o=WA.ui.displayActionMessage({message:(u=t.getString("openConfigTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE or touch here to configure",callback:()=>_(r)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const u=t.getString("openConfigTrigger");a&&(u&&u==="onaction"?s():_(r))}),WA.room.onLeaveLayer(e).subscribe(()=>{o&&o.remove(),i()})}function Ue(){return WA.onInit().then(()=>{Re().catch(r=>console.error(r)),Ge().catch(r=>console.error(r)),Ve().catch(r=>console.error(r)),Pe().catch(r=>console.error(r)),Ce().catch(r=>console.error(r))}).catch(r=>console.error(r))}console.log("Script started successfully");let p;WA.onInit().then(()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const r=WA.room.mapURL,t={url:r.substring(0,r.lastIndexOf("/"))+"/information.html",visible:!0,allowApi:!0,allowPolicy:"",position:{vertical:"top",horizontal:"middle"},size:{width:"500px",height:"250px"}};WA.ui.website.open(t);const o="Asking for a clue will cost you 2 minutes.",n="You have to start over. This may be due to data corruption or you are trying to cheat ^^";let a=!1;WA.state.GameStarted===!1&&(p=WA.ui.openPopup("startPopup","You have just landed in an abandoned train station. By clicking on ESCAPE the 20 minutes timer will start.",[{label:"ESCAPE",className:"error",callback:()=>{WA.state.GameStarted=!0,y()}}])),WA.room.onLeaveLayer("start").subscribe(y),WA.room.onEnterLayer("cigarette").subscribe(()=>{WA.state.CigaretteVisible&&(p=WA.ui.openPopup("cigarettePopup","A cigarette left on the ground. There is a trash can for that, but this person was obviously in a hurry.",[]),a=!0,WA.state.CigaretteVisible=!1)}),WA.room.onLeaveLayer("cigarette").subscribe(y),WA.room.area.onEnter("garbageCan").subscribe(()=>{a&&!WA.state.CigaretteComplete&&(p=WA.ui.openPopup("garbageCanPopup","You throw the cigarette in the garbage can. Thank you.",[]),WA.state.CigaretteComplete=!0)}),WA.room.area.onLeave("garbageCan").subscribe(y),WA.room.area.onEnter("info").subscribe(()=>{p=WA.ui.openPopup("infoPopup",`The goal is to enter all together in the train n\xB01 and to start it in order to escape!
The door can only be opened by the robot in front of the door if you complete all the riddles.`,[])}),WA.room.area.onLeave("info").subscribe(y),WA.room.area.onEnter("game").subscribe(()=>{p=WA.ui.openPopup("gamePopup","I'm playing Tic-tac-toe but I'm tired of playing against this robot. Can you try to win the game with circles?",[]),WA.state.TicTacToeStarted=!0}),WA.room.area.onLeave("game").subscribe(y),WA.room.onEnterLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToeOngoing=!0,WA.room.setProperty("tic-tac-toe","silent",!0))}),WA.room.onLeaveLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToeOngoing=!1)}),WA.room.onEnterLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay1=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay2)}),WA.room.onLeaveLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay1=!1)}),WA.room.onEnterLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay2=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay1)}),WA.room.onLeaveLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay2=!1)}),WA.chat.onChatMessage(s=>{WA.state.QuestionOngoing&&(WA.state.QuestionComplete=s=="2018",WA.state.QuestionComplete?(WA.chat.sendChatMessage("Correct. You can now enter.","KindRobot000"),WA.state.TrainDoorOpen=!0):(WA.chat.sendChatMessage("Incorrect. You now have to start all over again.","KindRobot000"),WA.state.TicTacToeStarted=!1,WA.state.TicTacToeOngoing=!1,WA.state.TicTacToePlay1=!1,WA.state.TicTacToePlay2=!1,WA.state.TicTacToeComplete=!1,WA.state.CigaretteVisible=!0,a=!1,WA.state.CigaretteComplete=!1,WA.state.QuestionOngoing=!1,WA.state.QuestionComplete=!1,WA.state.TrainDoorOpen=!1))}),WA.room.area.onEnter("room1bot").subscribe(()=>{WA.state.QuestionComplete||(WA.state.TicTacToeComplete&&WA.state.CigaretteComplete?(WA.chat.sendChatMessage("Stranger, can you tell me in what year the train track switches were fully automated? Type your answer here.","KindRobot000"),WA.chat.sendChatMessage("Think carefully! If you make a mistake you will have to start all over again","KindRobot000"),WA.state.QuestionOngoing=!0):p=WA.ui.openPopup("room1botPopup","Stranger, I'll block the access to this train until you prove your worth. "+o,[{label:"Give me a clue",className:"primary",callback:()=>G(1)}]))}),WA.room.area.onLeave("room1bot").subscribe(y),WA.room.area.onEnter("goToDriverCabine").subscribe(()=>{WA.nav.goToRoom("map.json#driver-cabine");const s=137*32,i=16*32;WA.camera.set(s,i,500,500,!1,!0)}),WA.room.onEnterLayer("driver-cabine").subscribe(()=>{WA.state.TrainDoorOpen||(WA.controls.disablePlayerControls(),p=WA.ui.openPopup("driverCabinePopup",n,[]))}),WA.room.area.onEnter("room2bot").subscribe(()=>{p=WA.ui.openPopup("room2botPopup","Stranger, it seems this train is not going to start until you find the right key. "+o,[{label:"Give me a clue",className:"primary",callback:()=>G(2)}])}),WA.room.area.onLeave("room2bot").subscribe(y),WA.room.onEnterLayer("room2Object1").subscribe(()=>{p=WA.ui.openPopup("room2Object1Popup","You found a cup of coffee. Studies have shown that the optimal consumption for healthy adults is 3 cups of coffee.",[]),WA.state.CoffeeFound=!0}),WA.room.onLeaveLayer("room2Object1").subscribe(y),WA.room.onEnterLayer("room2Object2").subscribe(()=>{p=WA.ui.openPopup("room2Object2Popup","You found a Pretzel. Given the size of this Pretzel, 1 is more than enough for breakfast!",[]),WA.state.PretzelFound=!0}),WA.room.onLeaveLayer("room2Object2").subscribe(y),WA.room.onEnterLayer("room2Object3").subscribe(()=>{p=WA.ui.openPopup("room2Object3Popup","You found an old map. It is very rare. Only 8 like this one exist in the world!",[]),WA.state.OldMapFound=!0}),WA.room.onLeaveLayer("room2Object3").subscribe(y),WA.room.onEnterLayer("room2Object4").subscribe(()=>{p=WA.ui.openPopup("room2Object4Popup","You found some coins. 5 more and you might be able to trade them for a bank bill.",[]),WA.state.CoinsFound=!0}),WA.room.onLeaveLayer("room2Object4").subscribe(y),WA.room.onEnterLayer("max-maulwurf").subscribe(()=>{WA.state.TrainStarted?p=WA.ui.openPopup("maxMaulwurfPopup","Oops, looks like the train has been stopped immediately! Investigate the area to find out what happened.",[]):(WA.controls.disablePlayerControls(),p=WA.ui.openPopup("maxMaulwurfPopup",n,[]))}),WA.room.onLeaveLayer("max-maulwurf").subscribe(y),WA.room.area.onEnter("room3bot").subscribe(()=>{p=WA.ui.openPopup("room3botPopup","Stranger, it seems your beloved Max Maulwurf is hangry. You will be blocked here until you comfort him. "+o,[{label:"Give me a clue",className:"primary",callback:()=>G(3)}])}),WA.room.area.onLeave("room3bot").subscribe(y),Ue().then(()=>{console.log("Scripting API Extra ready")}).catch(s=>console.error(s))}).catch(r=>console.error(r));function y(){p!==void 0&&(p.close(),p=void 0)}function G(r){let e="";for(let t=1;t<4;t++)if(e=`Room${r}Clue${t}`,WA.state.loadVariable(e)===!1){WA.state.saveVariable(e,!0);return}}
